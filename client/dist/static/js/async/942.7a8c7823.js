"use strict";(self.webpackChunk_trustify_ui_client=self.webpackChunk_trustify_ui_client||[]).push([["942"],{3804:function(e,t,r){r.d(t,{p:()=>i});var n=r(24246),a=r(27230);let i=e=>{let{paginationProps:t,isTop:r,isCompact:i=!1,idPrefix:s=""}=e;return(0,n.jsx)(a.t,{id:`${s?`${s}-`:""}pagination-${r?"top":"bottom"}`,variant:r?a.a.top:a.a.bottom,isCompact:i,...t,widgetId:"pagination-id"})}},39826:function(e,t,r){r.d(t,{y:()=>l});var n=r(24246),a=r(10707),i=r(16668),s=r(42160);let l=()=>(0,n.jsx)(a.ub,{status:"danger",headingLevel:"h4",titleText:"Unable to connect",icon:s.ZP,variant:a.IQ.sm,children:(0,n.jsx)(i.B,{children:"There was an error retrieving data. Check your connection and try again."})})},31336:function(e,t,r){r.d(t,{hp:()=>p,qK:()=>b,Cx:()=>g});var n=r(24246),a=r(8305),i=r(13754),s=r(31423),l=r(11165),o=r(94154),d=r(39826),c=r(10707),u=r(16668),m=r(22119);let h=e=>{let{title:t,description:r}=e;return(0,n.jsx)(c.ub,{titleText:t,headingLevel:"h4",icon:m.ZP,variant:c.IQ.sm,children:r&&(0,n.jsx)(u.B,{children:r})})},x=()=>(0,n.jsx)(h,{title:"No data available",description:"No data available to be shown here."}),p=e=>{let{numRenderedColumns:t,isLoading:r=!1,isError:c=!1,isNoData:u=!1,errorEmptyState:m=null,noDataEmptyState:h=null,children:p}=e;return(0,n.jsx)(n.Fragment,{children:r?(0,n.jsx)(s.p,{children:(0,n.jsx)(l.Tr,{children:(0,n.jsx)(o.Td,{colSpan:t,children:(0,n.jsx)(a.b,{children:(0,n.jsx)(i.$,{size:"xl"})})})})}):c?(0,n.jsx)(s.p,{"aria-label":"Table error",children:(0,n.jsx)(l.Tr,{children:(0,n.jsx)(o.Td,{colSpan:t,children:(0,n.jsx)(a.b,{children:m||(0,n.jsx)(d.y,{})})})})}):u?(0,n.jsx)(s.p,{"aria-label":"Table error",children:(0,n.jsx)(l.Tr,{children:(0,n.jsx)(o.Td,{colSpan:t,children:(0,n.jsx)(a.b,{children:h||(0,n.jsx)(x,{})})})})}):p})};var j=r(89330);let b=e=>{let{numColumnsBeforeData:t,numColumnsAfterData:r,children:a}=e;return(0,n.jsxs)(n.Fragment,{children:[Array(t).fill(null).map((e,t)=>(0,n.jsx)(j.Th,{screenReaderText:`before-data-${t}`},t)),a,Array(r).fill(null).map((e,t)=>(0,n.jsx)(j.Th,{screenReaderText:`after-data-${t}`},t))]})},g=e=>{let{isExpansionEnabled:t=!1,expandableVariant:r,getSelectCheckboxTdProps:a,propHelpers:{getSingleExpandButtonTdProps:i},item:s,rowIndex:l,children:d}=e;return(0,n.jsxs)(n.Fragment,{children:[t&&"single"===r?(0,n.jsx)(o.Td,{...i({item:s,rowIndex:l})}):null,a?(0,n.jsx)(o.Td,{...a({item:s,rowIndex:l})}):null,d]})}},45840:function(e,t,r){r.r(t),r.d(t,{default:()=>ed});var n=r(24246),a=r(27378),i=r(27693),s=r.n(i),l=r(17528),o=r(45043),d=r(68802),c=r(70715),u=r(40982),m=r(89226),h=r(70400),x=r(79551),p=r(32489),j=r(90519),b=r(35072),g=r(43490),f=r(62997),y=r(4835),T=r(14350),v=r(11165),C=r(89330),D=r(31423),I=r(94154),S=r(88935),w=r(67447),K=r(48513);let P=e=>{let{isOpen:t,title:r,titleIconVariant:a,message:i,confirmBtnLabel:s,cancelBtnLabel:o,inProgress:d,confirmBtnVariant:c,onClose:u,onConfirm:m,onCancel:h}=e,g=(0,n.jsx)(l.zx,{id:"confirm-dialog-button","aria-label":"confirm",variant:c,isDisabled:d,onClick:m,children:s},"confirm"),f=h?(0,n.jsx)(l.zx,{id:"confirm-cancel-button","aria-label":"cancel",variant:l.Wu.link,isDisabled:d,onClick:h,children:o},"cancel"):void 0;return(0,n.jsxs)(x.u,{id:"confirm-dialog",variant:"small",isOpen:t,onClose:u,"aria-label":"Confirm dialog",children:[(0,n.jsx)(p.x,{title:r,titleIconVariant:a}),(0,n.jsx)(j.f,{children:i}),(0,n.jsx)(b.m,{children:h?(0,n.jsxs)(n.Fragment,{children:[g,f]}):(0,n.jsx)(n.Fragment,{children:g})})]})};var k=r(15726),E=r(1183),$=r(68e3),L=r(75503),N=r(74502),F=r(50576),O=r(40371);let R="importers",B=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],{isLoading:t,error:r,refetch:n,data:a}=(0,E.a)({queryKey:[R],queryFn:()=>(0,O.CZ)({client:F.L}),refetchInterval:!e&&N.x6});return{importers:a?.data||[],isFetching:t,fetchError:r,refetch:n}},Z=(e,t)=>{let r=(0,$.NL)();return(0,L.D)({mutationFn:e=>(0,O.Ro)({client:F.L,path:{name:e.importerName},body:e.configuration}),onSuccess:async(t,n)=>{e(),await r.invalidateQueries({queryKey:[R]})},onError:t})},V=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{data:r,isLoading:n,refetch:a,error:i}=(0,E.a)({queryKey:[R,e,"reports"],queryFn:()=>(0,O.qi)({client:F.L,path:{name:e}}),refetchInterval:!t&&N.x6});return{result:{data:r?.data?.items||[],total:r?.data?.total??0},isFetching:n,fetchError:i,refetch:a}};var A=r(63706),z=r(14629),q=r(2499),W=r(34747),_=r(46770),M=r(64766),U=r(30528),H=r(42160),Q=r(1353),Y=r(82786),G=r(19879),J=r(18976);let X=e=>{let{preset:t,status:r,icon:a,className:i="",label:s}=e,l={Canceled:{icon:(0,n.jsx)(G.ZP,{}),status:"info",label:"Canceled"},Completed:{icon:(0,n.jsx)(U.ZP,{}),status:"success",label:"Completed"},Error:{icon:(0,n.jsx)(H.ZP,{}),status:"danger",label:"Error"},Failed:{icon:(0,n.jsx)(H.ZP,{}),status:"danger",label:"Failed"},InProgress:{icon:(0,n.jsx)(Q.ZP,{}),status:"info",label:"In-progress"},NotStarted:{icon:(0,n.jsx)(G.ZP,{}),label:"Not started"},Ok:{icon:(0,n.jsx)(U.ZP,{}),status:"success"},Scheduled:{icon:(0,n.jsx)(Y.ZP,{}),status:"info",label:"Scheduled"},Unknown:{icon:(0,n.jsx)(J.ZP,{})}},o=t&&l[t];return(0,n.jsxs)(W.k,{flexWrap:{default:"nowrap"},spaceItems:{default:"spaceItemsSm"},children:[(0,n.jsx)(_.B,{children:(0,n.jsx)(e=>{let{children:t}=e;return o?.tooltipMessage?(0,n.jsx)(q.u,{content:o?.tooltipMessage,children:t}):(0,n.jsx)(n.Fragment,{children:t})},{children:(0,n.jsx)(M.J,{status:r||o?.status,className:i,children:a||o?.icon||(0,n.jsx)(J.ZP,{})})})}),(0,n.jsx)(_.B,{children:s||o?.label})]})};var ee=r(3804),et=r(31336),er=r(49988),en=r(90241),ea=r(20227);let ei=e=>{let{value:t}=e;return(0,n.jsx)(en.E,{"aria-label":"Progress of Importer ",value:t.current,min:0,max:t.total,measureLocation:ea.nK.inside,size:en.L.sm})},es=new Map([["waiting","Scheduled"],["running","InProgress"]]),el=e=>{let{state:t}=e;return(0,n.jsx)(X,{preset:(e=>{if(es.has(e)){let t=es.get(e);if(t)return t}return"NotStarted"})(t)})},eo=e=>{let t=Object.keys(e.configuration??{})[0],r=e.configuration[t];return r?.disabled!==!1?"disabled":"running"===e.state?"running":"scheduled"},ed=()=>{let e,{pushNotification:t}=a.useContext(k.c),[r,i]=a.useState(null),[s,x]=a.useState(null),p=(e,t)=>{x(e),i(t)},{importers:j,isFetching:b,fetchError:g}=B(),{mutate:K}=Z(()=>{},e=>{t({title:"Error while enabling/disabling the Importer",variant:"danger"})}),E=(e,t)=>{let r=Object.keys(e.configuration??{})[0],n={...e.configuration[r],disabled:!t};K({importerName:e.name,configuration:{[r]:n}})},$=()=>{t({title:"Importer scheduled to run as soon as possible",variant:"success"})},L=e=>{t({title:(0,A.dr)(e),variant:"danger"})},N=e=>{(0,O.Pj)({client:F.L,path:{name:e},body:!0}).then($).catch(L)},R=(0,er.sz)({tableName:"importers-table",idProperty:"name",items:j,columnNames:{name:"Name",type:"Type",description:"Description",source:"Source",period:"Period",state:"State"},hasActionsColumn:!0,isSortEnabled:!0,sortableColumns:["name"],getSortValues:e=>({name:e.name}),isPaginationEnabled:!0,isExpansionEnabled:!0,expandableVariant:"single",isFilterEnabled:!0,filterCategories:[{categoryKey:"name",title:"Name",type:z.vA.search,placeholderText:"Search by name...",getItemValue:e=>e.name||""},{categoryKey:"status",title:"Status",type:z.vA.multiselect,logicOperator:"OR",selectOptions:[{value:"scheduled",label:"Scheduled"},{value:"running",label:"Running"},{value:"disabled",label:"Disabled"}],placeholderText:"Status",matcher:(e,t)=>e===eo(t)}]}),{currentPageItems:V,numRenderedColumns:q,propHelpers:{toolbarProps:W,filterToolbarProps:_,paginationToolbarItemProps:M,paginationProps:U,tableProps:H,getThProps:Q,getTrProps:Y,getTdProps:G},expansionDerivedState:{isCellExpanded:J}}=R;switch(s){case"enable":e={title:"Enable Importer",titleIconVariant:"info",message:`Are you sure you want to enable the Importer ${r?.name}?`,confirmBtnVariant:l.Wu.primary,confirmBtnLabel:"Enable",cancelBtnLabel:"Cancel"};break;case"disable":e={title:"Disable Importer",titleIconVariant:"info",message:`Are you sure you want to disable the Importer ${r?.name}?`,confirmBtnVariant:l.Wu.primary,confirmBtnLabel:"Disable",cancelBtnLabel:"Cancel"};break;case"run":e={title:"Run Importer",titleIconVariant:"info",message:`Are you sure you want to run the Importer ${r?.name}?`,confirmBtnVariant:l.Wu.primary,confirmBtnLabel:"Run",cancelBtnLabel:"Cancel"};break;default:e=null}return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.NP,{hasBodyWrapper:!1,children:(0,n.jsx)(d.V,{children:(0,n.jsx)(d.V,{component:"h1",children:"Importers"})})}),(0,n.jsx)(o.NP,{hasBodyWrapper:!1,children:(0,n.jsxs)("div",{children:[(0,n.jsx)(c.o,{...W,children:(0,n.jsxs)(u.c,{children:[(0,n.jsx)(z.Ki,{showFiltersSideBySide:!0,..._}),(0,n.jsx)(m.E,{...M,children:(0,n.jsx)(ee.p,{idPrefix:"importer-table",isTop:!0,paginationProps:U})})]})}),(0,n.jsxs)(y.i,{...H,"aria-label":"Importer table",children:[(0,n.jsx)(T.h,{children:(0,n.jsx)(v.Tr,{children:(0,n.jsxs)(et.qK,{...R,children:[(0,n.jsx)(C.Th,{...Q({columnKey:"name"})}),(0,n.jsx)(C.Th,{...Q({columnKey:"type"})}),(0,n.jsx)(C.Th,{...Q({columnKey:"description"})}),(0,n.jsx)(C.Th,{...Q({columnKey:"source"})}),(0,n.jsx)(C.Th,{...Q({columnKey:"period"})}),(0,n.jsx)(C.Th,{...Q({columnKey:"state"})})]})})}),(0,n.jsx)(et.hp,{isLoading:b,isError:!!g,isNoData:0===j.length,numRenderedColumns:q,children:V?.map((e,t)=>{let r=Object.keys(e.configuration??{})[0],a=e.configuration[r],i=eo(e);return(0,n.jsxs)(D.p,{children:[(0,n.jsx)(v.Tr,{...Y({item:e}),children:(0,n.jsxs)(et.Cx,{...R,item:e,rowIndex:t,children:[(0,n.jsx)(I.Td,{width:15,modifier:"truncate",...G({columnKey:"name"}),children:e.name}),(0,n.jsx)(I.Td,{width:10,modifier:"truncate",...G({columnKey:"type"}),children:r}),(0,n.jsx)(I.Td,{width:20,modifier:"truncate",...G({columnKey:"description"}),children:a?.description}),(0,n.jsx)(I.Td,{width:20,modifier:"truncate",...G({columnKey:"source"}),children:a?.source}),(0,n.jsx)(I.Td,{width:10,modifier:"truncate",...G({columnKey:"period"}),children:a?.period}),(0,n.jsx)(I.Td,{width:10,modifier:"truncate",...G({columnKey:"state"}),children:"disabled"===i?(0,n.jsx)(h._,{color:"orange",children:"Disabled"}):"running"===i&&e.progress?(0,n.jsx)(ei,{value:e.progress}):(0,n.jsx)(el,{state:e.state})}),(0,n.jsx)(I.Td,{isActionCell:!0,children:(0,n.jsx)(S.k,{items:[..."disabled"===i?[{title:"Enable",onClick:()=>{p("enable",e)}}]:[{title:"Run",onClick:()=>{p("run",e)},isDisabled:"running"===i},{title:"Disable",onClick:()=>{p("disable",e)}}]]})})]})}),J(e)?(0,n.jsx)(v.Tr,{isExpanded:!0,children:(0,n.jsx)(I.Td,{colSpan:7,children:(0,n.jsx)("div",{className:f.Z.mMd,children:(0,n.jsx)(w.G,{children:(0,n.jsx)(eu,{importer:e})})})})}):null]},e.name)})})]}),(0,n.jsx)(ee.p,{idPrefix:"importer-table",isTop:!1,paginationProps:U})]})}),s&&e&&(0,n.jsx)(P,{...e,isOpen:!0,onCancel:()=>x(null),onClose:()=>x(null),onConfirm:()=>{if(r)switch(s){case"enable":E(r,!0);break;case"disable":E(r,!1);break;case"run":N(r.name)}i(null),x(null)}})]})},ec=e=>Object.entries(e).map(e=>{let[t,r]=e;return Object.entries(r).map(e=>{let[r,n]=e;return{title:`${t.charAt(0).toUpperCase()+t.slice(1)}: "${r}"`,body:n.map(e=>{let t=null;switch(e.severity){case"none":t=N.xT.green;break;case"low":t=N.xT.cyan;break;case"medium":t=N.xT.yellow;break;case"high":t=N.xT.lightBlue;break;case"critical":t=N.xT.red}return`${t??""}${e.severity.charAt(0).toUpperCase()+e.severity.slice(1)}: ${N.xT.defaultForegroundColorAtStartup} ${e.message}`}).join(N.xT.endLine)}}).map(e=>`${N.xT.underline}${e.title}${N.xT.reset}${N.xT.endLine}${e.body}`).join(`${N.xT.endLine}${N.xT.endLine}`)}),eu=e=>{let{importer:t}=e,[r,i]=a.useState([]),[o,d]=a.useState(!1),h=()=>d(!o),{result:{data:f},isFetching:S,fetchError:w}=V(t.name),P=a.useMemo(()=>{let e={isRunning:!0,id:"root",startDate:void 0,endDate:void 0,duration:t.progress?.estimatedSecondsRemaining?t.progress?.estimatedSecondsRemaining*1e3:void 0,numberOfItems:t.progress?.current,error:void 0,messages:void 0},r=f.map(e=>{let t;if(e.report?.startDate&&e.report.endDate){let r=s()(e.report.startDate);t=s()(e.report.endDate).diff(r)}return{isRunning:!1,id:e.id,startDate:e.report?.startDate,endDate:e.report?.endDate,duration:t,numberOfItems:e.report?.numberOfItems,error:e.error??void 0,messages:e.report?.messages}});return[..."running"===t.state?[e]:[],...r]},[t,f]),k=(0,er.sz)({variant:"compact",tableName:"report-table",idProperty:"id",items:P,columnNames:{startDate:"Start date",endDate:"End date",numberOfItems:"Number of items",status:"Status",duration:"Duration"},isPaginationEnabled:!0,initialItemsPerPage:5,isSortEnabled:!0,sortableColumns:["startDate","endDate"],initialSort:{columnKey:"startDate",direction:"desc"},getSortValues:e=>({startDate:!e.startDate||s()(e.startDate).valueOf(),endDate:!e.endDate||s()(e.endDate).valueOf()}),isFilterEnabled:!1,isExpansionEnabled:!1}),{currentPageItems:E,numRenderedColumns:$,propHelpers:{toolbarProps:L,tableProps:N,paginationToolbarItemProps:F,paginationProps:O,getThProps:R,getTrProps:B,getTdProps:Z}}=k;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(c.o,{...L,children:(0,n.jsx)(u.c,{children:(0,n.jsx)(m.E,{...F,children:(0,n.jsx)(ee.p,{idPrefix:"report-table",isTop:!0,paginationProps:O})})})}),(0,n.jsxs)(y.i,{...N,"aria-label":"Report table",children:[(0,n.jsx)(K.Y,{children:"Importer reports"}),(0,n.jsx)(T.h,{children:(0,n.jsx)(v.Tr,{children:(0,n.jsxs)(et.qK,{...k,children:[(0,n.jsx)(C.Th,{...R({columnKey:"startDate"})}),(0,n.jsx)(C.Th,{...R({columnKey:"endDate"})}),(0,n.jsx)(C.Th,{...R({columnKey:"numberOfItems"})}),(0,n.jsx)(C.Th,{...R({columnKey:"status"})}),(0,n.jsx)(C.Th,{...R({columnKey:"duration"})})]})})}),(0,n.jsx)(et.hp,{isLoading:S,isError:!!w,isNoData:P?.length===0,numRenderedColumns:$,children:E?.map((e,t)=>(0,n.jsx)(D.p,{children:(0,n.jsx)(v.Tr,{...B({item:e}),children:(0,n.jsxs)(et.Cx,{...k,item:e,rowIndex:t,children:[(0,n.jsx)(I.Td,{width:15,modifier:"truncate",...Z({columnKey:"startDate"}),children:(0,A.o0)(e.startDate)}),(0,n.jsx)(I.Td,{width:15,modifier:"truncate",...Z({columnKey:"endDate"}),children:(0,A.o0)(e.endDate)}),(0,n.jsx)(I.Td,{width:15,modifier:"truncate",...Z({columnKey:"numberOfItems"}),children:e.numberOfItems}),(0,n.jsx)(I.Td,{width:30,modifier:"truncate",...Z({columnKey:"status"}),children:e.isRunning?(0,n.jsx)(el,{state:"running"}):(0,n.jsx)(t=>{let{children:r}=t;return e.messages?(0,n.jsx)(l.zx,{isInline:!0,variant:"link",onClick:()=>{i(ec(e.messages??{})),h()},children:r}):r},{children:e.error?(0,n.jsx)(X,{preset:"Failed",label:e.error}):(0,n.jsx)(X,{preset:"Completed",label:"Finished successfully"})})}),(0,n.jsx)(I.Td,{width:25,modifier:"truncate",...Z({columnKey:"duration"}),children:e.duration?e.isRunning?`Time remaining: ${s().duration(e.duration).humanize()}`:`Run for: ${s().duration(e.duration).humanize()}`:""})]})})},e.id))})]}),(0,n.jsx)(ee.p,{idPrefix:"report-table",isTop:!1,paginationProps:O}),(0,n.jsxs)(x.u,{variant:"large",isOpen:o,onClose:h,children:[(0,n.jsx)(p.x,{title:"Log"}),(0,n.jsx)(j.f,{children:(0,n.jsx)(g.nU,{hasLineNumbers:!1,height:400,data:r,theme:"dark",toolbar:(0,n.jsx)(c.o,{children:(0,n.jsx)(u.c,{children:(0,n.jsx)(m.E,{children:(0,n.jsx)(g.Yt,{placeholder:"Search value",minSearchChars:1})})})})})}),(0,n.jsx)(b.m,{children:(0,n.jsx)(l.zx,{variant:"link",onClick:h,children:"Close"},"cancel")})]})]})}}}]);
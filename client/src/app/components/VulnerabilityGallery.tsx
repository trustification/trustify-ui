import type React from "react";

import { Divider, Flex, FlexItem } from "@patternfly/react-core";
import { right } from "@patternfly/react-core/dist/esm/helpers/Popper/thirdparty/popper-core";

import { compareBySeverityFn } from "@app/api/model-utils";
import type { ExtendedSeverity } from "@app/api/models";
import { SeverityShieldAndText } from "@app/components/SeverityShieldAndText";

interface VulnerabilityGalleryProps {
  severities: { [key in ExtendedSeverity]: number };
}

export const VulnerabilityGallery: React.FC<VulnerabilityGalleryProps> = ({
  severities,
}) => {
  const severityCount = Object.values(severities).reduce((prev, acc) => {
    return prev + acc;
  }, 0);

  return (
    <Flex
      spaceItems={{ default: "spaceItemsSm" }}
      alignItems={{ default: "alignItemsCenter" }}
      flexWrap={{ default: "nowrap" }}
      style={{ whiteSpace: "nowrap" }}
    >
      <FlexItem aria-label="total" style={{ minWidth: 15, textAlign: right }}>
        {severityCount}
      </FlexItem>
      <Divider orientation={{ default: "vertical" }} />
      <FlexItem>
        <Flex>
          {Object.entries(severities)
            .filter(([_severity, count]) => count > 0)
            .sort(
              compareBySeverityFn(
                ([severity, _count]) => severity as ExtendedSeverity,
              ),
            )
            .reverse()
            .map(([severity, count]) => (
              <FlexItem key={severity} spacer={{ default: "spacerXs" }}>
                <Flex
                  aria-label={severity}
                  spaceItems={{ default: "spaceItemsXs" }}
                  alignItems={{ default: "alignItemsCenter" }}
                  flexWrap={{ default: "nowrap" }}
                  style={{ whiteSpace: "nowrap" }}
                >
                  <FlexItem>
                    <SeverityShieldAndText
                      value={severity as ExtendedSeverity}
                      score={null}
                    />
                  </FlexItem>
                  <FlexItem>{count}</FlexItem>
                </Flex>
              </FlexItem>
            ))}
        </Flex>
      </FlexItem>
    </Flex>
  );
};
